<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4361ee">
    <title>Ù…Ø¯ÙŠØ± Ø§Ù„Ø¯ÙŠÙˆÙ† - Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --success-color: #4caf50;
            --danger-color: #f44336;
            --warning-color: #ff9800; /* Ù„ÙˆÙ† Ø§Ù„Ø¯ÙŠÙ† - Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ/Ø£ØµÙØ± */
            --bg-color: #f1f3f9;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary-color), #3f37c9);
            color: white; padding: 15px; text-align: center;
            border-radius: 0 0 20px 20px;
        }

        .container {
            flex: 1; overflow-y: auto;
            padding: 15px; padding-bottom: 90px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 18px; padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }

        input, select {
            width: 100%; padding: 12px; margin: 8px 0;
            border: 1px solid #e0e0e0; border-radius: 12px;
            font-size: 16px; font-family: 'Cairo';
        }

        .btn {
            border: none; padding: 12px; border-radius: 12px;
            font-weight: 700; width: 100%; font-family: 'Cairo';
            cursor: pointer; transition: 0.2s;
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-danger { background: #fee2e2; color: var(--danger-color); }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin: 10px 0; }
        .stat-card { background: #f8fafc; padding: 10px; border-radius: 12px; text-align: center; }

        .history-table {
            width: 100%; border-collapse: collapse;
            margin-top: 10px; font-size: 14px;
        }

        .history-table th { color: #64748b; padding: 10px 5px; border-bottom: 2px solid #edf2f7; }
        .history-table td { padding: 12px 5px; border-bottom: 1px solid #f1f5f9; text-align: center; }

        /* ØªÙ„ÙˆÙŠÙ† Ø§Ù„ØµÙÙˆÙ */
        .row-add { background-color: #fffde7; } /* Ø£ØµÙØ± Ø®ÙÙŠÙ Ù„Ù„Ø¯ÙŠÙ† */
        .row-pay { background-color: #ffebee; } /* Ø£Ø­Ù…Ø± Ø®ÙÙŠÙ Ù„Ù„Ø¯ÙØ¹ */

        .action-btn {
            border: none; padding: 5px 8px; border-radius: 6px;
            font-weight: bold; font-size: 11px; cursor: pointer; margin: 2px;
        }
        .edit-btn { background: #e3f2fd; color: #1976d2; }
        .del-btn { background: #ffebee; color: #d32f2f; }

        .bottom-nav {
            position: fixed; bottom: 0; width: 100%;
            background: white; display: flex; padding: 10px 0;
            border-top: 1px solid #eee;
        }

        .nav-item { flex: 1; text-align: center; color: #a0aec0; font-size: 12px; }
        .nav-item.active { color: var(--primary-color); }

        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .type-label { font-size: 10px; display: block; font-weight: bold; }
        .color-add { color: var(--warning-color); }
        .color-pay { color: var(--danger-color); }
    </style>
</head>
<body>

<div class="app-header"><h3>ğŸ’° ØªØ·Ø¨ÙŠÙ‚ Ø¯ÙŠÙˆÙ†ÙŠ Ø§Ù„Ù…Ø·ÙˆØ±</h3></div>

<div class="container">
    <div id="tab1" class="tab-content active">
        <div class="card">
            <h4>ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h4>
            <input type="text" id="newName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ">
            <input type="number" id="newAmount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ (Ø¯ÙŠÙ†)">
            <button class="btn btn-primary" onclick="addPerson()">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
        <div class="card">
            <h4>ğŸ“Š Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h4>
            <table style="width: 100%; text-align: center;">
                <thead style="color: #64748b;"><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th></tr></thead>
                <tbody id="remainingBody"></tbody>
            </table>
        </div>
    </div>

    <div id="tab2" class="tab-content">
        <div class="card">
            <label>Ø§Ø®ØªØ± Ø§Ù„Ø­Ø³Ø§Ø¨:</label>
            <select id="personSelect" onchange="loadData()"></select>
            <div class="stat-grid">
                <div class="stat-card"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><br><b id="total">0</b></div>
                <div class="stat-card"><span>Ù…Ø¯ÙÙˆØ¹</span><br><b id="paid" style="color:var(--success-color)">0</b></div>
                <div class="stat-card"><span>Ø¨Ø§Ù‚ÙŠ</span><br><b id="remain" style="color:var(--danger-color)">0</b></div>
            </div>
            <input type="number" id="amountInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº">
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" style="background: var(--warning-color);" onclick="processAction('add')">â• Ø¯ÙŠÙ†</button>
                <button class="btn btn-success" style="background: var(--danger-color);" onclick="processAction('pay')">ğŸ’µ Ø¯ÙØ¹</button>
            </div>
        </div>

        <div class="card">
            <h4>ğŸ“œ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ù„ÙˆÙ†</h4>
            <table class="history-table">
                <thead>
                    <tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>
                </thead>
                <tbody id="historyList"></tbody>
            </table>
            <button class="btn btn-danger" style="margin-top:20px;" onclick="deletePersonFull()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        </div>
    </div>
</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="openTab(1, this)">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav-item" onclick="openTab(2, this)">ğŸ’¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
</div>

<script>
    let data = JSON.parse(localStorage.getItem("debts_v5_pro")) || {};

    function save() {
        localStorage.setItem("debts_v5_pro", JSON.stringify(data));
        renderHome();
    }

    function renderHome() {
        const tbody = document.getElementById('remainingBody');
        tbody.innerHTML = '';
        for (let name in data) {
            let remain = data[name].total - data[name].paid;
            tbody.innerHTML += `<tr><td>${name}</td><td><b>${remain}</b></td></tr>`;
        }
        updateSelect();
    }

    function updateSelect() {
        const select = document.getElementById('personSelect');
        const current = select.value;
        select.innerHTML = '';
        for (let name in data) {
            select.innerHTML += `<option value="${name}">${name}</option>`;
        }
        if (current && data[current]) select.value = current;
    }

    function addPerson() {
        const name = document.getElementById('newName').value.trim();
        const amt = Number(document.getElementById('newAmount').value) || 0;
        if (!name || data[name]) return alert("Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ ØºÙŠØ± ØµØ§Ù„Ø­");
        data[name] = { total: amt, paid: 0, history: [] };
        if (amt > 0) data[name].history.push({ id: Date.now(), date: tdy(), type: 'Ø¥Ø¶Ø§ÙØ©', amount: amt });
        document.getElementById('newName').value = '';
        document.getElementById('newAmount').value = '';
        save();
    }

    function loadData() {
        const name = document.getElementById('personSelect').value;
        if (!name) return;
        const p = data[name];
        document.getElementById('total').textContent = p.total;
        document.getElementById('paid').textContent = p.paid;
        document.getElementById('remain').textContent = p.total - p.paid;

        const hList = document.getElementById('historyList');
        hList.innerHTML = p.history.slice().reverse().map(h => {
            const isAdd = h.type === 'Ø¥Ø¶Ø§ÙØ©';
            return `
            <tr class="${isAdd ? 'row-add' : 'row-pay'}">
                <td>${h.date}<span class="type-label ${isAdd ? 'color-add' : 'color-pay'}">${h.type}</span></td>
                <td><b>${h.amount}</b></td>
                <td>
                    <button class="action-btn edit-btn" onclick="editItem('${name}', ${h.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="action-btn del-btn" onclick="deleteHistoryItem('${name}', ${h.id})">Ø­Ø°Ù</button>
                </td>
            </tr>`;
        }).join('');
    }

    function processAction(type) {
        const name = document.getElementById('personSelect').value;
        const val = Number(document.getElementById('amountInput').value);
        if (!val || !name) return;
        if (type === 'add') data[name].total += val;
        else data[name].paid += val;
        data[name].history.push({ id: Date.now(), date: tdy(), type: type === 'add' ? 'Ø¥Ø¶Ø§ÙØ©' : 'Ø¯ÙØ¹', amount: val });
        document.getElementById('amountInput').value = '';
        save(); loadData();
    }

    function deleteHistoryItem(personName, itemId) {
        if (!confirm("Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ")) return;
        const person = data[personName];
        const idx = person.history.findIndex(h => h.id === itemId);
        const item = person.history[idx];
        if (item.type === 'Ø¥Ø¶Ø§ÙØ©') person.total -= item.amount;
        else person.paid -= item.amount;
        person.history.splice(idx, 1);
        save(); loadData();
    }

    function editItem(personName, itemId) {
        const person = data[personName];
        const idx = person.history.findIndex(h => h.id === itemId);
        const item = person.history[idx];
        const newAmt = prompt(`ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¨Ù„Øº ${item.type}:`, item.amount);
        
        if (newAmt !== null && !isNaN(newAmt) && newAmt !== "") {
            const diff = Number(newAmt) - item.amount;
            if (item.type === 'Ø¥Ø¶Ø§ÙØ©') person.total += diff;
            else person.paid += diff;
            item.amount = Number(newAmt);
            save(); loadData();
        }
    }

    function deletePersonFull() {
        const name = document.getElementById('personSelect').value;
        if (confirm(`Ø­Ø°Ù ${name} Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ`)) {
            delete data[name];
            save(); renderHome();
            openTab(1, document.querySelector('.nav-item'));
        }
    }

    function openTab(num, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('tab' + num).classList.add('active');
        el.classList.add('active');
        if (num === 2) loadData();
    }

    function tdy() { return new Date().toLocaleDateString('ar-DZ', { month: 'numeric', day: 'numeric' }); }
    renderHome();
</script>
</body>
</html>
